{% extends "base.html" %}

{% block content %}
<div class="mb-6 sm:mb-8">
  <h1 class="text-xl sm:text-2xl font-semibold mb-4 text-zinc-900 dark:text-white">Поиск</h1>
  
  <form action="{{ url_for('search') }}" method="GET" class="space-y-3">
    <div class="flex flex-col sm:flex-row gap-3">
      <input type="text" name="q" value="{{ query }}" placeholder="Поиск..." 
        class="flex-1 px-4 py-3 sm:py-2.5 border border-zinc-300 dark:border-zinc-600 rounded-xl focus:outline-none focus:border-zinc-900 dark:focus:border-zinc-100 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white placeholder-zinc-400"
        autofocus>
      <select name="type" class="px-4 py-3 sm:py-2.5 border border-zinc-300 dark:border-zinc-600 rounded-xl focus:outline-none focus:border-zinc-900 dark:focus:border-zinc-100 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white">
        <option value="all" {% if type_filter == 'all' %}selected{% endif %}>Всё</option>
        <option value="users" {% if type_filter == 'users' %}selected{% endif %}>Пользователи</option>
        <option value="posts" {% if type_filter == 'posts' %}selected{% endif %}>Посты</option>
      </select>
    </div>
    <button type="submit" class="w-full sm:w-auto px-6 py-3 sm:py-2.5 bg-zinc-900 text-white hover:bg-zinc-800 dark:bg-zinc-100 dark:text-zinc-900 dark:hover:bg-zinc-200 rounded-xl font-medium transition-colors">
      Найти
    </button>
  </form>
</div>

{% if query %}
  {% if results.users or results.posts %}
    <div class="space-y-6 sm:space-y-8">
      {% if results.users %}
        <div>
          <h2 class="text-lg font-semibold mb-4 text-zinc-900 dark:text-white">Пользователи</h2>
          <div class="space-y-3">
            {% for user in results.users %}
              <a href="{{ url_for('profile', username=user.username) }}" class="flex items-center gap-4 p-4 border border-zinc-200 dark:border-zinc-700 rounded-xl hover:border-zinc-300 dark:hover:border-zinc-600 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors bg-white dark:bg-zinc-800">
                {% if user.avatar and user.avatar != 'default_avatar.png' %}
                  <img src="{{ url_for('avatar_file', filename=user.avatar) }}" alt="" class="w-12 h-12 rounded-full bg-zinc-100 dark:bg-zinc-700 object-cover">
                {% else %}
                  <div class="w-12 h-12 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-lg font-semibold text-zinc-500 dark:text-zinc-400">
                    {{ user.display_name[0].upper() }}
                  </div>
                {% endif %}
                <div>
                  <p class="font-medium text-zinc-900 dark:text-white">{{ user.display_name }}</p>
                  <p class="text-zinc-500 dark:text-zinc-400 text-sm">@{{ user.username }}</p>
                </div>
              </a>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      
      {% if results.posts %}
        <div>
          <h2 class="text-lg font-semibold mb-4 text-zinc-900 dark:text-white">Посты</h2>
          <div class="space-y-4">
            {% for post in results.posts %}
              <a href="{{ url_for('view_post', post_id=post.id) }}" class="block p-5 border border-zinc-200 dark:border-zinc-700 rounded-xl hover:border-zinc-300 dark:hover:border-zinc-600 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors bg-white dark:bg-zinc-800">
                <div class="flex items-center gap-2 mb-2 flex-wrap">
                  <span class="text-zinc-500 dark:text-zinc-400 text-sm">@{{ post.author.username if post.author else 'unknown' }}</span>
                  <span class="text-zinc-400 dark:text-zinc-500 text-sm">•</span>
                  <span class="text-zinc-500 dark:text-zinc-400 text-sm">{{ format_date(post.created_at) }}</span>
                </div>
                <p class="line-clamp-2 text-zinc-900 dark:text-white">{{ post.content }}</p>
              </a>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    </div>
  {% else %}
    <div class="text-center py-12 sm:py-16 text-zinc-500 dark:text-zinc-400">
      <p>Ничего не найдено по запросу "{{ query }}"</p>
    </div>
  {% endif %}
{% else %}
  <div class="text-center py-12 sm:py-16 text-zinc-500 dark:text-zinc-400">
    <p>Введите запрос для поиска</p>
  </div>
{% endif %}
{% endblock %}
